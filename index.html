<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </head>
  <body>
    <!-- <video autoplay muted loop id="bg-video">
      <source src="https://static.vecteezy.com/system/resources/previews/006/671/832/mp4/traveling-through-star-fields-in-space-to-a-distant-galaxy-free-video.mp4" type="video/mp4">
    </video> -->
    <div>
        <img id="movingImage" class="background-scroll" src="/images/codingHands_XL.gif"></img>
    </div>
    <row class="row, center">
      <div class="column">
        <div>
          <h1 id="header"></h1>
        </div>
        <div>
          <h2 id="subHeader" hidden></h2>
          <img id="peekImage" src="/images/codingHands_XL.gif" alt="photo here"></img>
        </div>
        <div>    
            <button id="aboutButton">About</button>
            <button id="playlistButton">Playlist</button>
            <button class="mode-toggle-buttons" id="sleepButton">Sleep</button>            
        </div>
      </div>
      <br>
      <div id="playlist" class="column">
        <iframe hidden style="border-radius:12px" src="https://open.spotify.com/embed/playlist/5bjZPb0M2d689ZFwEUMcjA?utm_source=generator" 
        width="100%" height="352" frameBorder="0" allowfullscreen="" 
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
        loading="lazy"></iframe>
      </div>
      <div id="bio" hidden class="column">
        <h2 style="color:navy;">I'm a software developer, polyglot<br> (日本語, 中文),<br>and guitar-slinging musical artist. <br><br>I enjoy animation, politics, and other nerdy things right here in sunny Los Angeles.</h2>
      </div>
    </row>
    <div class="footer"><p>webpage by <a href="https://www.linkedin.com/in/kovey-coles-8a5a01a6/" target="_blank" rel="noopener noreferrer">kovey coles</p></div>
    <script>
let isMorning = true;
let hasPlaylist = false;
let hasBio = false;
const morningMessage = 'Hello Friend!';
const nightMessage = 'Leaving?';
let snoreIntervalId = 0;
let snoreCount = 0;
let snoreLimit = 5;
let nextMovingImageTimeoutId = 0;

setTimeout(()=> {$("h3").hide("slow"); $("#peekImage").hide("slow");
    moveImagesAcrossScreen()}, 1000);

async function moveImagesAcrossScreen() {

    let movingImage = document.querySelector("#movingImage");
    movingImage.style.display = "flex";
    let windowWidth = window.innerWidth;
    let windowHeight = window.innerHeight;

    await moveRight(movingImage);
    console.log("completed move right")
    await moveLeft(movingImage);
    console.log("completed move left")
    nextMovingImageTimeoutId = setTimeout(moveImagesAcrossScreen, 5000);


    function moveRight(element) {
      return new Promise((resolve)=> {
          element.style.display = "flex";
          let pos = -1500;
          element.style.top = "-400px";
          let moveID = setInterval(()=>{
            pos+=10; 
            element.style.left = pos+"px";
            if (pos >= windowWidth*.75) {
              console.log("finished right | pos(x): " + pos + " pos(y): " + element.style.top + " ID: " + moveID);
              clearInterval(moveID);
              resolve();
            }
        }, 40);
      });
    }

    function moveLeft(element) {
      return new Promise((resolve)=> {
        element.style.display = "flex";
        let pos = windowWidth;
        element.style.top = windowHeight - 700 - (windowHeight*.05) + "px";
        let moveID = setInterval(()=>{
          pos-=10; 
          element.style.left = pos+"px";
          if (pos < -1500) {
            console.log("finished left| pos(x): " + pos + " pos(y): " + element.style.top + " ID: " + moveID);
            element.style.display = "none";
            clearInterval(moveID);
            resolve();
          }
        }, 40);
      });
    }
}

document.querySelector('#header').innerHTML = morningMessage;

const briefDisplay = function() {
    const message = isMorning ? "よろしくお願いします" : "慢走";
    $("#subHeader").text(message);
    setTimeout(()=> {$("#subHeader").show("slow")}, 250);
    setTimeout(()=>{$("#peekImage").show("slow");  if (!isMorning) $("#sleepButton").hide();}, isMorning ? 750 : 0);    
    setTimeout(()=> {$("#subHeader").hide("slow"); $("#peekImage").hide("slow"); $("#sleepButton").show();
    }, 3000);
};

const handleToggle = function(element, bool, headerText) {
    element.toggle("slow");
    let message = bool ? headerText : morningMessage
    $("#header").text(message);
};

const toggleNightMode = function(night) {
  $("#playlistButton").toggle();
  $("#aboutButton").toggle();
  if (night) {
    $("#movingImage").hide();
    clearTimeout(nextMovingImageTimeoutId);
      console.log("snore interval cleared: ", nextMovingImageTimeoutId);
    $("body").css("background-color", "darkblue");
    $("#header").css("color", "white");
    setTimeout(()=> {snoreIntervalId = setInterval(generateSnores, 1000)}, 5000);
  } else {
    $("body").css("background-color", "lightblue");
    $("#header").css("color", "navy");
    clearInterval(snoreIntervalId);
    console.log("snore interval cleared: ", snoreIntervalId)
    snoreCount = 0;
    moveImagesAcrossScreen();
  }
}

const generateSnores = function() {
  if (!isMorning) {
    let snores = "Zz";
    for (let i = 0; i < snoreCount; i++)
      snores+="z";
    $("#header").text(snores + "...");
    snoreCount = snoreCount == snoreLimit ? 0 : snoreCount+1;
  } else clearInterval(snoreIntervalId);
}

$(".mode-toggle-buttons").click(()=> { 
    let image = document.querySelector("#peekImage");
    isMorning = !isMorning;
    const message = isMorning ? morningMessage : nightMessage;
    let imageSource = isMorning ? "/images/codingHands_XL.gif" : "/images/bye-wave-trans.png";
    $("#peekImage").attr("src", imageSource);
    
    sway(image); // comment this out if its broken
    
    $("#header").text(message);
    $("#bio").hide("slow");
});

async function sway(element) {
    let swayRight = function(limit, pos) {
        return new Promise((resolve)=> {
          pos = pos ? pos : element.getBoundingClientRect().left;
          let originalPos = pos;
          let moveID = setInterval(()=>{
            pos+=3; 
            element.style.left = pos+"px";
            if (pos - originalPos >= limit) {
              clearInterval(moveID);
              resolve(pos);
            }
        }, 40);
      });
    }
    let swayLeft = function(limit, pos) {
        return new Promise((resolve)=> {
          pos = pos ? pos : element.getBoundingClientRect().left;
          let originalPos = pos;
          let moveID = setInterval(()=>{
            pos-=3; 
            element.style.left = pos+"px";
            if (originalPos - pos >= limit) {
              clearInterval(moveID);
              resolve(pos);
            }
        }, 40);
      });
    }

    let firstposition = await swayRight(40);
    let secondPosition = await swayLeft(80, firstposition);
    await swayRight(40, secondPosition); 
    element.style.left = "0px";
  }

$("#sleepButton").on("click", function(){
    if (!isMorning) {
      $("body").css("background-color", "darkblue");
      $("#sleepButton").prop("disabled", true);
      $("#sleepButton").html("Wake Up");
      setTimeout(()=>{document.querySelector('#header').innerHTML = "Zzzzz..."}, 2500);
      $("iframe").hide("slow"); 
      setTimeout(()=>{$("#sleepButton").prop("disabled", false)}, 3500);
    } else {
      $("#sleepButton").html("Sleep");
    }
    briefDisplay();
    toggleNightMode(!isMorning);
})

$("#playlistButton").on("click", function(){
  hasPlaylist = !hasPlaylist;
  $("iframe").toggleClass("loading-mask");
  handleToggle($("iframe"), hasPlaylist, "Enjoy some music ♫");
})

$("#aboutButton").click(function() {
  hasBio = !hasBio;
  if (hasBio && !hasPlaylist) {
    $("#peekImage").show("slow");    
    setTimeout(()=> {$("#peekImage").hide("slow")}, 3000);
  }
  handleToggle($("#bio"), hasBio, "A little about me");
})

$('.footer').mouseenter(()=> {
    //briefDisplay();
});

$('#header').mouseenter(()=> {
    if (!isMorning && snoreCount > 3)
      $("#header").text("**snore**");
});
    </script>
  </body>
</html>
